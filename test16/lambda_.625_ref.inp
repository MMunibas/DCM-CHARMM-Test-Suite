* PERT module energy evaluation as reference for thermodynamic integration routines
* with DCM in CHARMM
*

PRNLEV 2 NODE 0
BOMLEV -5

SET PATH par/

READ RTF CARD        NAME -
 @PATH/phf.top

READ PARAM CARD        NAME -
 @PATH/phf.par

OPEN UNIT 10 READ CARD NAME @PATH/step5_slu.pdb
READ SEQUENCE PDB UNIT 10
GENERATE SOLU
REWIND UNIT 10
READ COOR PDB UNIT 10
CLOSE UNIT 10

OPEN UNIT 10 READ CARD NAME @PATH/step5_slv.pdb
READ SEQUENCE PDB UNIT 10
GENERATE WAT NOANgle NODIhedral
REWIND UNIT 10
READ COOR PDB UNIT 10
CLOSE UNIT 10

NBONDS NBXMOD 5 ATOM CDIEL EPS 1.0 SHIFT VATOM VDISTANCE -
  VSWITCH CUTNB 99.0 CTOFNB 98.0 CTONNB 97. E14FAC 1.0


ENERgy

!================================================================
! PERT T.I. calculation setup, saving the current state as lambda=0
!================================================================
PERT SELE SEGI SOLU END

SCALAR CHARGE SET 0. SELE SEGI SOLU END

ENERgy LSTART 0.0 LSTOP 1.0 LAMB 0.0
ENERgy LSTART 0.0 LSTOP 1.0 LAMB 0.5
ENERgy LSTART 0.0 LSTOP 1.0 LAMB 1.0

SHAKE BOND TOL 1.0E-8 PARA
COOR STAT
CALC BOXX = (?XMAX - ?XMIN -1.0)
CRYSTAL DEFI CUBIC @BOXX @BOXX @BOXX 90. 90. 90. 
CRYSTAL BUILD nope 0
IMAGE BYRES XCEN 0.0 YCEN 0.0 ZCEN 0.0 SELE ALL END
NBONDS ATOM EWALD PMEWALD KAPPA 0.32  -
  CUTNB 14.0  CTOFNB 12.0 CTONnb 10.0 CUTIM 14.0 -
  atom vatom vdistance -
  VSWITCH SHIFT CDIE eps 1.0  e14fac 1.0  wmin 1.5

ENERgy LSTART 0.0 LSTOP 1.0 LAMB 0.0
ENERgy LSTART 0.0 LSTOP 1.0 LAMB 0.7
ENERgy LSTART 0.0 LSTOP 1.0 LAMB 1.0

TEST FIRST TOLER 0.000 SELE BYNU 1:15 END CRYS HOMO

stop
  open read  unit 32 card name equil.res
  read coor dynr curr unit 32


DYNA LEAP RESTART NSTEP 1000 TIMESTEP 0.001 -
  NTRFRQ 100 IUNREA 32 -
  IPRFRQ 0 INBFRQ -1 IMGFRQ 250 -
  IHTFRQ 0 IEQFRQ 0 -
  TSTRUCT 300.0 FINALT 300.0 FIRSTT 300.0 -
  CPT PCONst PREF 1.0 PGAMMA 20.0 PMASs 500 -
  TBATH 300. -
  NPRINT 1000 



STOP
